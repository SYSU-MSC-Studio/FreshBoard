@model FreshBoard.Views.Admin.UsersModel
@{
  ViewBag.Title = "用户管理";
}

<form id="form">
  <table class="ui compact celled table">
    <thead>
      <tr>
        <th></th>
        <th>邮箱</th>
        <th>手机号</th>
        <th>申请阶段</th>
        <th>权限</th>
      </tr>
    </thead>
    <tbody>
      @foreach(var user in Model.Users)
      {
      <tr>
        <td class="collapsing">
          <div class="ui fitted checkbox">
            <input type="checkbox" name="ids[]" value="@user.Id"> <label></label>
          </div>
        </td>
        <!-- <td>@user.Name</td> -->
        <td><a asp-action="User" asp-route-id="@user.Id">@user.Email</a></td>
        <td>@user.Phone</td>
        <td>@user.Period</td>
        <td>@user.HasPrivilege</td>
      </tr>
      }
    </tbody>
    <tfoot class="full-width">
      <tr>
        <th></th>
        <th colspan="4">
          <div class="ui small disabled button">
            修改申请阶段
          </div>
          <div class="ui small button" id="button-grant-admin">
            授予管理员权限
          </div>
        </th>
      </tr>
    </tfoot>
  </table>
</form>

<!-- 修改申请阶段 -->
<div class="ui modal">
  <i class="close icon"></i>
  <div class="header">
    验证手机号码
  </div>
  <div class="content">
    <form class="ui form" id="submit-code-form">
      <div class="field">
        <label>验证码</label>
        <input 
          type="text"
          name="token"
          placeholder="123456">
      </div>
    </form>
  </div>
  <div class="actions">
    <div class="ui black deny button">
      取消
    </div>
    <div class="ui positive right labeled icon button" id="submit-code">
      提交
      <i class="checkmark icon"></i>
    </div>
  </div>
</div>

@section Scripts
{
    <script lang="js">
    $(document).ready(function () {
      $('#button-grant-admin').click(function () {
        axios.post('/Admin/BatchToggleAdmin', new FormData(form))
          .then(function (res) {
            if(res&&res.data&&res.data.succeeded)
              document.location.reload();
            else
              alert(res&&res.data&&res.data.message);
          })
          .catch(alert);
      });
    });
  </script>
}